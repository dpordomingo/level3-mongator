<?php
    protected $mongator;

    public function __construct(\Mongator\Mongator $mongator)
    {
        $this->mongator = $mongator;
    }

    public function registerDefinitions()
    {
{% for key, class in extension.getMapping() %}
        $this->registerDefinition(
            '{{ key }}', 
            $this->get{{ class|replace({'\\': ''}) }}Repository()
        ); 

{% endfor %} 
    }

{% for class, config in config_classes %}
{% if 'repository' in config.classes|keys %}
    protected function get{{ class|replace({'\\': ''}) }}Repository()
    {
        $self = $this;

        return function(\Level3\Level3 $level3) use ($self) {
            return new \{{ config.classes.repository }}(
                $level3,
                $self->mongator
            );
        };
    }
{% endif %}
{% endfor %} 
